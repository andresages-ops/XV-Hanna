<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis XV Años - Hanna Paulina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #E4BEB8; color: #462F24; font-family: 'Segoe UI', Tahoma, sans-serif; }
        .oculto { display: none; }
        /* Scrollbar personalizado para el menú desplegable */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #E4BEB8; border-radius: 10px; }
    </style>
</head>
<body class="antialiased">
    <div class="max-w-md mx-auto bg-[#E4BEB8] min-h-screen relative shadow-lg overflow-hidden pb-20">

        <div id="pantalla-inicio" class="p-6">
            <div class="flex justify-center items-center mb-6 pt-4">
                <h1 class="font-bold tracking-[0.25em] text-3xl text-[#F8F6F4] drop-shadow-sm">MIS XV AÑOS</h1>
            </div>

            <div class="w-full aspect-square bg-white rounded-[40px] mb-6 overflow-hidden shadow-lg flex items-center justify-center border-4 border-[#F8F6F4]/40">
                <img src="logo-hanna.jpg" alt="Logo Hanna Paulina" class="w-full h-full object-cover">
            </div>

            <div class="text-center mb-8 mt-2">
                <p class="text-base text-[#F8F6F4] font-black tracking-widest mb-3 drop-shadow-sm">¡ESTÁS INVITADO!</p>
                <p class="text-2xl font-bold mb-1 text-[#462F24]">Quinta Los Agapantos</p>
                <p class="text-lg opacity-80 text-[#462F24]">Jueves 30 de Abril 2026</p>
            </div>

            <div class="flex justify-center space-x-3 mb-8">
                <div class="bg-[#F8F6F4] rounded-2xl w-16 h-20 flex flex-col items-center justify-center shadow-md">
                    <span id="dias" class="text-2xl font-bold text-[#462F24]">00</span><span class="text-[9px] font-bold tracking-widest opacity-60 mt-1 text-[#462F24]">DÍAS</span>
                </div>
                <div class="bg-[#F8F6F4] rounded-2xl w-16 h-20 flex flex-col items-center justify-center shadow-md">
                    <span id="horas" class="text-2xl font-bold text-[#462F24]">00</span><span class="text-[9px] font-bold tracking-widest opacity-60 mt-1 text-[#462F24]">HORAS</span>
                </div>
                <div class="bg-[#F8F6F4] rounded-2xl w-16 h-20 flex flex-col items-center justify-center shadow-md">
                    <span id="minutos" class="text-2xl font-bold text-[#462F24]">00</span><span class="text-[9px] font-bold tracking-widest opacity-60 mt-1 text-[#462F24]">MIN</span>
                </div>
                <div class="bg-[#F8F6F4] rounded-2xl w-16 h-20 flex flex-col items-center justify-center shadow-md">
                    <span id="segundos" class="text-2xl font-bold text-[#462F24]">00</span><span class="text-[9px] font-bold tracking-widest opacity-60 mt-1 text-[#462F24]">SEG</span>
                </div>
            </div>

            <button onclick="cambiarPantalla('pantalla-rsvp')" class="w-full bg-[#F8F6F4] hover:opacity-90 text-[#462F24] font-bold py-4 rounded-3xl shadow-md mb-4 flex justify-center items-center transition text-lg">
                Confirmar Asistencia
            </button>
        </div>

        <div id="pantalla-rsvp" class="p-6 oculto">
            <div class="flex items-center mb-8 pt-4">
                <button onclick="history.back()" class="text-[#F8F6F4] hover:text-[#462F24] mr-4 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                </button>
                <h1 class="font-semibold text-lg text-[#462F24]">Confirmación de Asistencia</h1>
            </div>

            <form id="form-rsvp" class="space-y-6 relative">
                <input type="hidden" id="estatus" name="estatus" value="Asiste">

                <div>
                    <label class="block text-xs font-bold tracking-wider mb-2 opacity-80 text-[#462F24]">TU NOMBRE COMPLETO</label>
                    <input type="text" id="nombre" name="nombre" placeholder="Escribe tu nombre aquí" required class="w-full bg-[#F8F6F4] rounded-2xl p-4 focus:outline-none shadow-sm text-[#462F24] placeholder-[#462F24]/40 border-2 border-transparent focus:border-[#462F24]/20 transition">
                </div>

                <div class="relative">
                    <label class="block text-xs font-bold tracking-wider mb-2 opacity-80 text-[#462F24]">NÚMERO DE INVITADOS</label>
                    
                    <input type="hidden" id="acompanantes" name="acompanantes" value="0">
                    
                    <button type="button" id="btn-dropdown" onclick="toggleDropdown()" class="w-full bg-[#F8F6F4] rounded-2xl p-4 flex justify-between items-center focus:outline-none shadow-sm text-[#462F24] border-2 border-transparent transition text-left">
                        <span id="texto-dropdown" class="opacity-100">Ninguno (Solo asisto yo)</span>
                        <svg id="icono-dropdown" class="w-5 h-5 opacity-60 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>

                    <div id="lista-dropdown" class="hidden absolute top-[85px] left-0 w-full bg-[#F8F6F4] rounded-2xl shadow-xl z-50 border border-[#E4BEB8]/40 max-h-[220px] overflow-y-auto transform transition-all">
                        <ul class="py-2 text-[#462F24] text-sm">
                            <li onclick="seleccionarInvitados(0, 'Ninguno (Solo asisto yo)')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition">Ninguno (Solo asisto yo)</li>
                            <li onclick="seleccionarInvitados(1, '1 Invitado')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">1 Invitado</li>
                            <li onclick="seleccionarInvitados(2, '2 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">2 Invitados</li>
                            <li onclick="seleccionarInvitados(3, '3 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">3 Invitados</li>
                            <li onclick="seleccionarInvitados(4, '4 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">4 Invitados</li>
                            <li onclick="seleccionarInvitados(5, '5 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">5 Invitados</li>
                            <li onclick="seleccionarInvitados(6, '6 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">6 Invitados</li>
                            <li onclick="seleccionarInvitados(7, '7 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">7 Invitados</li>
                            <li onclick="seleccionarInvitados(8, '8 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">8 Invitados</li>
                            <li onclick="seleccionarInvitados(9, '9 Invitados')" class="px-5 py-3 hover:bg-[#E4BEB8]/30 cursor-pointer transition border-t border-[#E4BEB8]/20">9 Invitados</li>
                        </ul>
                    </div>
                </div>

                <div id="campos-dinamicos" class="space-y-4"></div>

                <div>
                    <label class="block text-xs font-bold tracking-wider mb-2 opacity-80 text-[#462F24]">NOTAS ADICIONALES</label>
                    <textarea id="notas" name="notas" placeholder="Alergias o mensajes..." class="w-full bg-[#F8F6F4] rounded-2xl p-4 h-24 focus:outline-none shadow-sm text-[#462F24] placeholder-[#462F24]/40 border-2 border-transparent focus:border-[#462F24]/20 transition"></textarea>
                </div>

                <div class="flex space-x-3 mt-4">
                    <button type="button" onclick="enviarFormulario('No Asiste')" id="btn-no-asiste" class="w-[30%] bg-[#D98C8C] hover:bg-[#C97A7A] text-white font-bold py-4 rounded-3xl shadow-sm transition text-sm">
                        No asisto ✗
                    </button>
                    <button type="button" onclick="enviarFormulario('Asiste')" id="btn-asiste" class="w-[70%] bg-[#F8F6F4] hover:opacity-90 text-[#462F24] font-bold py-4 rounded-3xl shadow-sm transition text-lg">
                        Sí asisto ✓
                    </button>
                </div>
            </form>
        </div>

        <nav class="absolute bottom-0 w-full bg-[#E4BEB8] border-t border-[#F8F6F4]/30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] flex justify-around py-4 text-[10px] font-bold text-[#F8F6F4]">
            <button onclick="cambiarPantalla('pantalla-inicio')" class="flex flex-col items-center hover:text-[#462F24] transition"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>INICIO</button>
            <button onclick="cambiarPantalla('pantalla-rsvp')" class="flex flex-col items-center hover:text-[#462F24] transition"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>RSVP</button>
        </nav>

        <div id="custom-alert" class="fixed inset-0 bg-[#462F24]/60 hidden z-50 flex items-center justify-center p-4 transition-opacity duration-300">
            <div class="bg-[#F8F6F4] rounded-[35px] w-full max-w-sm p-8 text-center shadow-2xl border border-[#DECFC0]/50 transform transition-all">
                <div id="alert-icon-container" class="mx-auto w-16 h-16 rounded-full mb-4 flex items-center justify-center">
                    <svg id="alert-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
                </div>
                <h2 id="alert-title" class="font-bold text-xl mb-2 text-[#462F24] tracking-wide">Título</h2>
                <p id="alert-message" class="text-sm opacity-80 mb-8 text-[#462F24]">Mensaje</p>
                <button onclick="cerrarAlerta()" id="alert-button" class="w-full font-bold py-4 rounded-3xl shadow-sm transition">
                    Aceptar
                </button>
            </div>
        </div>

    </div>

    <script>
        // ⚠️ PEGA AQUÍ TU URL DE GOOGLE APPS SCRIPT
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZyxEx6E7g24qKRlZV6WC2m68Y-u0zQEJg5hjCi2TN6QHHaT5XHPXmK4QT_QVw9mGa/exec"; 

        const fechaEvento = new Date("Apr 30, 2026 19:00:00").getTime();
        setInterval(function() {
            const dist = fechaEvento - new Date().getTime();
            if (dist < 0) return;
            document.getElementById("dias").innerText = Math.floor(dist / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
            document.getElementById("horas").innerText = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
            document.getElementById("minutos").innerText = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
            document.getElementById("segundos").innerText = Math.floor((dist % (1000 * 60)) / 1000).toString().padStart(2, '0');
        }, 1000);

        window.history.replaceState({ pantalla: 'pantalla-inicio' }, '', '#inicio');

        window.addEventListener('popstate', function(event) {
            let pantalla = event.state ? event.state.pantalla : 'pantalla-inicio';
            mostrarPantallaVisual(pantalla);
            document.getElementById('custom-alert').classList.add('hidden'); 
        });

        function cambiarPantalla(idPantalla) {
            mostrarPantallaVisual(idPantalla);
            window.history.pushState({ pantalla: idPantalla }, '', '#' + idPantalla.replace('pantalla-', ''));
        }

        function mostrarPantallaVisual(idPantalla) {
            document.getElementById('pantalla-inicio').classList.add('oculto');
            document.getElementById('pantalla-rsvp').classList.add('oculto');
            document.getElementById(idPantalla).classList.remove('oculto');
            window.scrollTo(0, 0);
        }

        // LÓGICA DEL MENÚ DESPLEGABLE PERSONALIZADO
        function toggleDropdown() {
            const lista = document.getElementById('lista-dropdown');
            const icono = document.getElementById('icono-dropdown');
            const btn = document.getElementById('btn-dropdown');
            
            lista.classList.toggle('hidden');
            if(lista.classList.contains('hidden')) {
                icono.style.transform = 'rotate(0deg)';
                btn.classList.remove('border-[#462F24]/20');
            } else {
                icono.style.transform = 'rotate(180deg)';
                btn.classList.add('border-[#462F24]/20');
            }
        }

        function seleccionarInvitados(valor, texto) {
            document.getElementById('acompanantes').value = valor;
            document.getElementById('texto-dropdown').innerText = texto;
            toggleDropdown();
            generarCamposAcompanantes('campos-dinamicos', valor);
        }

        // Cierra el menú desplegable si tocas fuera de él
        window.onclick = function(event) {
            if (!event.target.closest('#btn-dropdown') && !event.target.closest('#lista-dropdown')) {
                const lista = document.getElementById('lista-dropdown');
                const icono = document.getElementById('icono-dropdown');
                const btn = document.getElementById('btn-dropdown');
                if (!lista.classList.contains('hidden')) {
                    lista.classList.add('hidden');
                    icono.style.transform = 'rotate(0deg)';
                    btn.classList.remove('border-[#462F24]/20');
                }
            }
        }

        function generarCamposAcompanantes(idContenedor, valor) {
            let contenedor = document.getElementById(idContenedor);
            contenedor.innerHTML = ''; 
            for (let i = 1; i <= parseInt(valor); i++) {
                contenedor.innerHTML += `<div class="p-4 bg-[#FDF7F4] rounded-2xl shadow-sm border border-white/40"><label class="block text-xs font-bold tracking-wider mb-2 opacity-80 text-[#462F24]">NOMBRE INVITADO ${i}</label><input type="text" name="c${i}" required class="w-full bg-transparent border-b-2 border-[#E4BEB8] p-2 focus:outline-none focus:border-[#462F24] text-[#462F24] transition placeholder-[#462F24]/30" placeholder="Nombre completo"></div>`;
            }
        }

        function mostrarAlerta(tipo, titulo, mensaje) {
            document.getElementById('alert-title').innerText = titulo;
            document.getElementById('alert-message').innerText = mensaje;
            
            const iconContainer = document.getElementById('alert-icon-container');
            const icon = document.getElementById('alert-icon');
            const btn = document.getElementById('alert-button');

            if (tipo === 'exito') {
                iconContainer.className = "mx-auto w-16 h-16 rounded-full mb-4 flex items-center justify-center bg-[#E4BEB8] text-[#F8F6F4] shadow-inner";
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>';
                btn.className = "w-full bg-[#E4BEB8] hover:opacity-90 text-[#462F24] font-bold py-4 rounded-3xl shadow-sm transition";
            } else if (tipo === 'triste') {
                iconContainer.className = "mx-auto w-16 h-16 rounded-full mb-4 flex items-center justify-center bg-[#D98C8C] text-[#F8F6F4] shadow-inner";
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>';
                btn.className = "w-full bg-[#D98C8C] hover:bg-[#C97A7A] text-white font-bold py-4 rounded-3xl shadow-sm transition";
            } else {
                iconContainer.className = "mx-auto w-16 h-16 rounded-full mb-4 flex items-center justify-center bg-red-100 text-red-500";
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
                btn.className = "w-full bg-gray-200 text-gray-800 font-bold py-4 rounded-3xl shadow-sm transition";
            }

            document.getElementById('custom-alert').classList.remove('hidden');
        }

        function cerrarAlerta() {
            document.getElementById('custom-alert').classList.add('hidden');
        }

        function enviarFormulario(estatus) {
            const form = document.getElementById('form-rsvp');
            if (!form.checkValidity()) { form.reportValidity(); return; } 
            
            document.getElementById('estatus').value = estatus;
            document.getElementById('btn-asiste').disabled = true;
            document.getElementById('btn-no-asiste').innerText = "...";

            fetch(SCRIPT_URL, { method: 'POST', body: new FormData(form) })
            .then(() => {
                form.reset();
                // Restaurar visualmente el menú desplegable al valor por defecto
                document.getElementById('texto-dropdown').innerText = 'Ninguno (Solo asisto yo)';
                document.getElementById('acompanantes').value = '0';
                
                generarCamposAcompanantes('campos-dinamicos', 0);
                cambiarPantalla('pantalla-inicio'); 
                
                if(estatus === 'Asiste') {
                    mostrarAlerta('exito', '¡Confirmado!', 'Nos emociona mucho contar con tu presencia. Hemos guardado tu registro exitosamente.');
                } else {
                    mostrarAlerta('triste', '¡Qué pena!', 'Lamentamos mucho que no puedas acompañarnos, pero agradecemos que nos avises.');
                }
            })
            .catch(() => {
                mostrarAlerta('error', 'Error de conexión', 'No pudimos enviar tu respuesta. Por favor revisa tu internet e intenta de nuevo.');
            })
            .finally(() => {
                document.getElementById('btn-asiste').disabled = false;
                document.getElementById('btn-no-asiste').innerText = "No asisto ✗";
            });
        }
    </script>
</body>
</html>